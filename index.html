<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Split Words Into Excel Columns</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { font-family: system-ui, Arial; padding: 20px; max-width: 900px; margin: auto; }
  textarea { width:100%; height: 250px; margin-top: 10px; font-family: monospace; }
  .card { border:1px solid #ccc; padding:15px; border-radius:8px; }
  button { padding:8px 14px; margin-right:6px; }
</style>
</head>
<body>

<h2>PDF / DOCX → Excel (Words → Columns)</h2>

<div class="card">
  <input id="fileInput" type="file" accept=".pdf,.docx">
  <button id="convertBtn">Convert → Excel</button>
  <button onclick="preview.value=''">Clear</button>

  <div id="status" style="margin-top:10px;color:#555">Upload your file.</div>

  <textarea id="preview" placeholder="Extracted text appears here..."></textarea>
</div>

<!-- Libraries -->
<script src="https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.worker.min.js";
</script>

<script src="https://unpkg.com/mammoth@1.4.21/dist/mammoth.browser.min.js"></script>
<script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
const fileInput = document.getElementById("fileInput");
const convertBtn = document.getElementById("convertBtn");
const preview = document.getElementById("preview");
const statusBox = document.getElementById("status");

convertBtn.onclick = async () => {
    const file = fileInput.files[0];
    if (!file) return alert("Please select a file.");

    statusBox.textContent = "Extracting text...";

    let text = "";
    if (file.name.toLowerCase().endsWith(".pdf")) {
        text = await extractPDF(file);
    } else if (file.name.toLowerCase().endsWith(".docx")) {
        text = await extractDOCX(file);
    } else {
        return alert("Only PDF or DOCX allowed.");
    }

    preview.value = text;

    // Split line-by-line
    const lines = text.split(/\r?\n/).filter(l => l.trim().length > 0);

    // Each line → columns (each word)
    const rows = lines.map(line => {
        return line
            .trim()
            .replace(/\s+/g, " ")
            .split(" "); // split into words → becomes columns
    });

    // Convert to Excel sheet
    const ws = XLSX.utils.aoa_to_sheet(rows);
    ws['!cols'] = Array(20).fill({ wch: 20 }); // width for 20 columns

    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Words");

    const outName = file.name.replace(/\.[^/.]+$/, "") + "_columns.xlsx";
    XLSX.writeFile(wb, outName);

    statusBox.textContent = "Done. Excel downloaded.";
};

// PDF extraction
async function extractPDF(file) {
    const buf = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: buf }).promise;
    let finalText = "";

    for (let pg = 1; pg <= pdf.numPages; pg++) {
        const page = await pdf.getPage(pg);
        const content = await page.getTextContent();
        const text = content.items.map(i => i.str).join(" ");
        finalText += text + "\n";
    }
    return finalText.trim();
}

// DOCX extraction
async function extractDOCX(file) {
    const arrayBuffer = await file.arrayBuffer();
    const result = await mammoth.extractRawText({ arrayBuffer });
    return result.value.trim();
}
</script>

</body>
</html>
